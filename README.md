## 概述  
地铁计算器U是一款用于计算上海地铁车号的android app，由[地铁计算器](https://github.com/nanhuajiaren/MetroCalculatorU)彻底重写而来，实现了原有的大部分功能。  
关于地铁列车的车号，请参见[上海地铁吧的相关贴子](http://tieba.baidu.com/p/6443728356)，该贴也是本代app制作的标准。  
## 实现
### 在线更新
虽说上海地铁的列车编号复杂，我还是使用了Json的数据结构，配合一个工具库，实现了在线更新。
### 数据结构说明
 **上海地铁吧来的必看**   
这个app的数据结构与传统的公式表并不一样，我认为是上海地铁列车编号体系的最佳概括:
#### 块( `Block` )
我把所有列车分成了若干个"块"。一个块可能是一型或者几个型号的列车，也有可能是某些列车的特定几节。块不一定要包含完整的一列车，也不一定要包含整个型号，它编组表上体现为一个矩形。  
#### 继承与覆写
 **本段的理解需要一定的理解力(有编程基础者最佳)**   
把列车划分为块以后，通过按照时间顺序写入所有的块，我可以自动地分配每个块的大部分信息。块的宽度继承自所属线路的编组，而块的尾号信息继承自全局表。块在输出中的线路信息继承自所属线路。  
对于车体号的3-5位(若总计6位)或3-4位(若总计5位)，我称它为 `mNumber` 。每个块的第一节车厢的 `mNumber` 记为 `mNumberStart` 。如果这个块的车体号是5位的，那么 `mNumberStart` 为1；如果是6位的，那么 `mNumberStart
` 是之前所有块的总车厢数+1。`trainNumberStart` (每个块的第一节列车编号)亦是如此。  
但是，我也可以手动地指定块的信息以覆盖自动分配(准确来说，有填入的字段不会进行分配计算)。例如，手动填入信息以让叛徒包公输出为3号线。甚至，我们可以让块有自定义的尾号，以反应小鲶鱼的扩编车厢。  
由此自动或手动分配所有块的信息后，计算就变得很简单:  
```
    列车实际编号 = (mNumber - mNumberStart) / blockWidth + trainNumberStart
```
---------
因此，程序里没有公式表里的公式。甚至，如果我们把json写得更详细一点，它就可以代表上海地铁所有列车的过去、今天和未来。